# SDD (Specification-Driven Development) をプロジェクトに適用する計画

## 概要

[github/spec-kit の SDD方法論](https://github.com/github/spec-kit/blob/main/spec-driven.md) をこのプロジェクトに適用する。仕様を開発の起点とし、仕様 → 計画 → 実装の一貫したパイプラインを構築する。

## 設計方針

- **独立した SDD システム**: `/sdd-*` コマンドとして新規作成。
- **プロジェクト非依存**: スキル・コマンド・テンプレートはプロジェクト固有の内容を含まない
- **計画書に全て統合**: 仕様・計画・タスクを `.steering/` の 1 ファイルに集約

## ワークフロー（3コマンド）

```
/sdd-specify    →  .steering/[date]-[name].md を作成（Part 1: 仕様）
       ↓
/sdd-plan       →  同ファイルに Part 2: 実装計画+タスク を追記
       ↓
/sdd-implement  →  計画に基づいてステップバイステップで実装
```

## 計画書の構造

`.steering/` の各ファイルは以下の 2 部構成。テンプレートは `.steering/templates/sdd-plan.md`。

```markdown
# [機能名]

## Part 1: 仕様 (Specification)
├── 概要・動機
├── 詳細仕様（動作、API契約、データモデル）
├── 受入基準（Given-When-Then）
├── エッジケース・エラー処理
├── 制約・依存関係
├── テスト戦略
├── 未解決事項（[NEEDS CLARIFICATION]）
└── プロジェクト憲法チェックリスト

## Part 2: 実装計画 (Implementation Plan)
├── 進捗サマリー
├── アーキテクチャ変更
├── 実装フェーズ（テスト先行順）
│   └── 各フェーズ内にアトミックなタスク（依存関係・完了条件付き）
├── シンプリシティゲート
├── リスク評価
├── 成功基準
└── 実装ログ
```

---

## コンテンツ配置

| 内容 | 配置先 |
|------|--------|
| SDD原則・プロジェクト憲法・フェーズゲート・不確実性マーカー | `sdd-principles` スキル |
| SDDワークフロー概要・コマンド一覧 | `CLAUDE.md` |
| 仕様+計画の統合テンプレート | `.steering/templates/sdd-plan.md` |

---

## ファイル一覧

### 1. `.claude/skills/sdd-principles/SKILL.md` — SDD原則スキル

コマンド実行時に参照するナレッジベース:
- SDD コンセプト（仕様 = ソースオブトゥルース）
- 基本原則 5 つ（共有言語、実行可能仕様、継続的改良、明示的不確実性、双方向フィードバック）
- プロジェクト憲法（9条テーブル + 運用ルール）
- フェーズゲート定義（ゲート1: Specify→Plan、ゲート2: Plan→Implement）
- 不確実性マーカー仕様（記法・運用ルール・例）

### 2. `.steering/templates/sdd-plan.md` — 仕様+計画 統合テンプレート

`{{PLACEHOLDER}}` 形式。プロジェクト憲法の具体的な条項内容をハードコードしない。

**Part 1: 仕様セクション** (1.1〜1.8):
- 概要（目的、スコープ、動機）
- 詳細仕様（機能要件、API契約、データモデル）
- 受入基準（Given-When-Then 形式）
- エッジケース
- 制約事項（セキュリティ、パフォーマンス、依存関係）
- テスト戦略
- 不確実性（`[NEEDS CLARIFICATION]` 一覧）
- プロジェクト憲法チェックリスト

**Part 2: 実装計画セクション** (2.1〜2.7):
- 進捗サマリー
- アーキテクチャ変更
- 実装フェーズ（チェックボックス付きアトミックタスク）
- シンプリシティゲート
- リスク評価
- 成功基準
- 実装ログ

### 3. `CLAUDE.md` — SDDワークフロー（既存ファイルに追記）

- スキルテーブルに `sdd-principles` 行を追加
- SDDワークフローセクション: コマンド一覧、計画書パス、プロジェクト憲法はスキル参照

### 4. `.claude/commands/sdd-specify.md` — 仕様作成コマンド

ワークフロー:
1. `sdd-principles` スキル・テンプレートを読み込み
2. 要件ヒアリング（不明点は質問、推測禁止）
3. コードベース調査（影響範囲・既存パターン確認）
4. テンプレートの Part 1（仕様セクション）を記入し `.steering/[YYYYMMDD]-[name].md` に保存
5. プロジェクト憲法チェックリスト検証
6. フェーズゲート1 確認
7. ユーザー承認待ち

### 5. `.claude/commands/sdd-plan.md` — 計画+タスク導出コマンド

ワークフロー:
1. `sdd-principles` スキルを読み込み、仕様書を特定
2. フェーズゲート1 検証（未通過なら中止）
3. アーキテクチャ設計
4. フェーズ分解（受入基準→アトミックタスク、テスト先行）
5. シンプリシティゲート（条VII）
6. リスク評価
7. 同ファイルに Part 2（実装計画セクション）を追記
8. ユーザー承認待ち

### 6. `.claude/commands/sdd-implement.md` — 実装実行コマンド

ワークフロー:
1. `sdd-principles` スキルを読み込み、計画書を特定
2. フェーズゲート2 検証（未通過なら中止）
3. 進捗確認（中断再開対応）
4. フェーズごとにタスクをステップバイステップで実装
5. 各タスク完了時に計画書のチェックボックスを更新
6. 各フェーズ完了時にユーザー確認
7. 全完了時に最終レポート

動作ルール:
- プロジェクト憲法を遵守
- 計画にない変更は行わない
- 受入基準で各タスクの完了を判定
- ブロッカー時は仕様/計画への差し戻しを提案
- 実装ログに記録
