# トップ画面追加

> ステータス: 実装完了
> 作成日: 2026-01-31
> 最終更新: 2026-01-31

---

## Part 1: 仕様 (Specification)

### 1.1 概要

**目的**: アプリケーションのトップ画面（ランディングページ）を追加する。

**スコープ**: 既存の `GET /` ルートを変更し、プレーンテキストの代わりにHTMLページを返すようにする。

**動機**: 現在 `GET /` は `"HELLO WORLD"` というプレーンテキストを返すのみで、Webアプリケーションとしての体裁がない。HTMLページとしてタイトルを表示するトップ画面を提供する。

### 1.2 詳細仕様

#### 機能要件

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| F-001 | トップ画面表示 | `GET /` でHTMLページを返し、タイトル「Claude Example」を表示する | 必須 |

#### API契約

##### GET /

- **説明**: トップ画面のHTMLページを返す
- **Request**:
  - Headers: なし（特別なヘッダー不要）
  - Body: なし
- **Response**:
  - Success (200):
    - Content-Type: `text/html`
    - Body: HTMLドキュメント（`<h1>Claude Example</h1>` を含む）
  - Error: なし（静的HTMLの返却のみ）

#### データモデル

なし（データベースやモデルは使用しない）

### 1.3 受入基準

| ID | Given (前提条件) | When (操作) | Then (期待結果) |
|----|-----------------|-------------|----------------|
| AC-001 | サーバーが起動している | `GET /` にリクエストを送る | ステータス200でHTMLが返る |
| AC-002 | サーバーが起動している | `GET /` のレスポンスを確認する | `<h1>Claude Example</h1>` がレスポンスに含まれる |
| AC-003 | サーバーが起動している | `GET /` のレスポンスヘッダーを確認する | Content-Type が `text/html` を含む |

### 1.4 エッジケース

| ID | シナリオ | 期待される動作 |
|----|----------|---------------|
| EC-001 | 存在しないパスにアクセス | Express のデフォルト404レスポンスが返る（今回のスコープ外） |

### 1.5 制約事項

#### セキュリティ
- HTMLはインラインで生成（テンプレートエンジン不使用）。ユーザー入力を含まないため、XSSリスクなし。

#### パフォーマンス
- 静的HTMLの返却のみのため、特別な考慮不要。

#### 依存関係

| パッケージ | バージョン | 用途 | 採用理由 |
|-----------|-----------|------|---------|
| ejs | 最新安定版 | ビューエンジン | ユーザー指定。HTMLテンプレートをロジックから分離するため |
| vitest | 最新安定版 | テストフレームワーク（devDependencies） | ユーザー指定 |
| supertest | 最新安定版 | HTTPテスト（devDependencies） | Express ルートの統合テストに必要 |

### 1.6 テスト戦略

#### 統合テスト
- `GET /` がステータス200を返すこと
- レスポンスに `<h1>Claude Example</h1>` が含まれること
- Content-Type が `text/html` を含むこと

### 1.7 不確実性

**未解決数**: 0

なし。全ての要件が確認済み。

### 1.8 プロジェクト憲法チェックリスト

| 条 | 原則 | 準拠 | 備考 |
|----|------|------|------|
| I | モジュール先行 | - [x] | ルート層（routes/index.js）とアプリ層（app.js）が分離済み |
| II | 契約先行 | - [x] | API契約（GET / → HTML 200）を仕様で定義済み |
| III | テスト先行 | - [x] | テスト戦略で統合テストを定義済み |
| IV | 仕様完全性 | - [x] | NEEDS CLARIFICATION マーカーなし |
| V | 最小依存 | - [x] | ejs（ビューエンジン、ユーザー指定）、vitest（テスト、ユーザー指定）、supertest（HTTPテスト）を追加。各採用理由を明記済み |
| VI | 関心の分離 | - [x] | HTML生成はルート層の責務として分離 |
| VII | 簡潔性ゲート | - [x] | 変更は最小限（1ファイル、数行の変更） |
| VIII | 直接利用 | - [x] | Express の `res.send()` を直接使用、不要な抽象化なし |
| IX | 統合テスト優先 | - [x] | HTTPリクエスト経由の統合テストを計画 |

---

## Part 2: 実装計画 (Implementation Plan)

### 2.1 進捗サマリー

| フェーズ | ステータス | 進捗 |
|---------|-----------|------|
| フェーズ1: テスト準備 | 完了 | 2/2 |
| フェーズ2: 実装 | 完了 | 3/3 |
| フェーズ3: 検証 | 完了 | 1/1 |

**全体進捗**: 6/6 ステップ完了

### 2.2 アーキテクチャ変更

#### 新規ファイル

| ファイル | 責務 |
|---------|------|
| `backend/src/routes/index.spec.js` | GET / ルートの統合テスト |
| `backend/src/views/index.ejs` | トップ画面の EJS テンプレート |

#### 変更ファイル

| ファイル | 変更内容 |
|---------|---------|
| `backend/package.json` | ejs を dependencies に、vitest・supertest を devDependencies に追加。test スクリプト追加 |
| `backend/src/app.js` | ejs ビューエンジンの設定を追加 |
| `backend/src/routes/index.js` | `res.send('HELLO WORLD')` → `res.render('index')` に変更 |

### 2.3 実装フェーズ

#### フェーズ1: テスト準備

| ステップ | タスク | ファイル | 依存 | 完了条件 |
|----------|--------|---------|------|---------|
| 1.1 | - [x] ejs を dependencies に、vitest・supertest を devDependencies に追加。test スクリプトを追加し `npm install` 実行 | `backend/package.json` | なし | `npm test` コマンドが実行可能 |
| 1.2 | - [x] AC-001〜AC-003 に基づく統合テストを vitest + supertest で作成（この時点ではテストは失敗する） | `backend/src/routes/index.spec.js` | 1.1 | テストファイルが存在し、3つのテストケースが定義されている |

#### フェーズ2: 実装

| ステップ | タスク | ファイル | 依存 | 完了条件 |
|----------|--------|---------|------|---------|
| 2.1 | - [x] ejs ビューエンジンの設定と views ディレクトリの指定を追加。app を export する | `backend/src/app.js` | 1.2 | `app.get('view engine')` が `'ejs'` を返す |
| 2.2 | - [x] トップ画面の EJS テンプレートを作成（`<h1>Claude Example</h1>` を含む HTML） | `backend/src/views/index.ejs` | 2.1 | テンプレートファイルが存在する |
| 2.3 | - [x] `res.send('HELLO WORLD')` を `res.render('index')` に変更 | `backend/src/routes/index.js` | 2.2 | ルートが `res.render` を使用している |

#### フェーズ3: 検証

| ステップ | タスク | ファイル | 依存 | 完了条件 |
|----------|--------|---------|------|---------|
| 3.1 | - [x] `npm test` で全テストがパスすることを確認 | - | 2.3 | 全3テストケースがパス |

### 2.4 シンプリシティゲート

- [x] 関数・ファイルの行数が上限内に収まる見込み（各ファイル数行〜十数行程度）
- [x] ネスト深度が上限内に収まる見込み（ネスト増加なし）

### 2.5 リスク評価

| リスク | 影響度 | 発生確率 | 軽減策 |
|--------|--------|---------|--------|
| Express v5 と ejs の互換性 | 低 | 低 | Express v5 のビューエンジンAPIは v4 と同等。テストで確認する |

### 2.6 成功基準

仕様の受入基準（1.3）を満たすこと:

- [x] AC-001: `GET /` がステータス200でHTMLを返す
- [x] AC-002: レスポンスに `<h1>Claude Example</h1>` が含まれる
- [x] AC-003: Content-Type が `text/html` を含む

### 2.7 実装ログ

| 日時 | ステップ | ステータス | 備考 |
|------|---------|-----------|------|
| 2026-01-31 | フェーズ1 | 完了 | テスト準備（vitest + supertest 導入、統合テスト作成） |
| 2026-01-31 | フェーズ2 | 完了 | 実装（ejs設定、テンプレート作成、ルート変更） |
| 2026-01-31 | フェーズ3 | 完了 | 検証（全3テストパス）。vitest ESM制約に対応し vitest.config.js を追加 |
