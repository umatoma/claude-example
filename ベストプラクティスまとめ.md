# Claude Code ベストプラクティス レポート

6つの情報源を調査・分析し、Claude Codeを効果的に使用するためのベストプラクティスを体系的にまとめたレポート。

---

## 情報源

| # | ソース | 種別 |
|---|--------|------|
| 1 | [Anthropic公式ドキュメント - Best Practices](https://code.claude.com/docs/en/best-practices) | 公式 |
| 2 | [Dometrain - Creating the Perfect CLAUDE.md](https://dometrain.com/blog/creating-the-perfect-claudemd-for-claude-code/) | ブログ |
| 3 | [Reddit/ykdojo - Top 10 Claude Code Tips (40+ Tips)](https://github.com/ykdojo/claude-code-tips) | コミュニティ |
| 4 | [Anthropic - The Complete Guide to Building Skills for Claude](https://resources.anthropic.com/hubfs/The-Complete-Guide-to-Building-Skill-for-Claude.pdf?hsLang=en) | 公式PDF |
| 5 | [VLD-BC - CLI Agents Part 2: Claude Code Best Practices](https://vld-bc.com/blog/cli-agents-part2-claude-code-best-practices) | ブログ |
| 6 | [Builder.io - Claude MD Guide](https://www.builder.io/blog/claude-md-guide) | ブログ |

---

## 1. コンテキスト管理（最重要）

**全ソースが一致して指摘する最重要事項：コンテキストウィンドウの管理がClaude Codeの性能を左右する。**

### 核心原則

- コンテキストウィンドウが埋まるほど、LLMの性能は劣化する（ソース1,3,5）
- 約200kトークンのうち、システムプロンプト＋ツール（約22k）＋自動コンパクトバッファ（45k）を差し引くと、実際に使えるのは約133kトークン（ソース5）
- **「AIのコンテキストは牛乳のようなもの：新鮮で凝縮されたものが最良」**（ソース3 - Tip 5）

### 実践テクニック

| テクニック | 説明 | ソース |
|-----------|------|--------|
| `/clear`の頻繁な使用 | 無関係なタスク間でコンテキストをリセット | 1,3,5 |
| 新しい会話の開始 | トピックが変わったら新しい会話を始める | 1,3 |
| `/compact`の活用 | 手動でコンテキストを圧縮（`/compact APIの変更に注目`のように指示付きも可） | 1,5 |
| サブエージェントの活用 | 調査を別コンテキストで実行し、要約だけ返す | 1,5 |
| HANDOFF.mdの作成 | 進捗をまとめたファイルを作成し、新しい会話に引き継ぐ | 3 |
| `/context`で監視 | トークン使用状況をモニタリング | 5 |

### アンチパターン

- **キッチンシンク・セッション**: 1つの会話で無関係なタスクを混在させる → `/clear`で解決
- **無限探索**: スコープを限定せずに調査を依頼し、大量のファイルを読み込む → サブエージェントを使うか調査を狭める
- **訂正の繰り返し**: 2回以上訂正しても直らない場合、コンテキストが汚染されている → `/clear`して改善したプロンプトで再開

---

## 2. CLAUDE.mdの設計と運用

**全ソースがCLAUDE.mdをClaude Code効果の基盤と位置づけている。**

### 作成方法

1. `/init`コマンドで初期ファイルを自動生成（ソース1,2,6）
2. 生成結果をレビューし、不要な内容を削除（ソース6）
3. 継続的に更新・メンテナンスする（ソース2,6）

### 含めるべき内容

| カテゴリ | 具体例 | ソース |
|----------|--------|--------|
| ターミナルコマンド | ビルド、テスト、リント、DB操作の具体的なコマンド | 1,2,6 |
| コーディング規約 | ES Modules使用、命名規則、インデント等 | 1,2,6 |
| プロジェクト構造 | ディレクトリ構成とアーキテクチャパターン | 2,6 |
| ワークフロー | 新機能追加やPR作成の手順 | 2 |
| 業務用語 | ドメイン固有の用語定義 | 2 |
| プロジェクトの注意点 | 非自明な動作や特有の挙動 | 6 |

### 含めるべきでない内容

| 避けるべきもの | 理由 | ソース |
|---------------|------|--------|
| コードを読めばわかること | 冗長でコンテキストを浪費 | 1 |
| 言語の標準的な慣例 | Claudeは既に知っている | 1 |
| 頻繁に変わる情報 | メンテナンスが追いつかない | 1 |
| 詳細なAPIドキュメント | リンクで代替 | 1 |
| 自明な実践（「クリーンなコードを書く」等） | 実質的な指示にならない | 1 |

### 配置場所

| パス | 適用範囲 | ソース |
|------|---------|--------|
| `~/.claude/CLAUDE.md` | 全プロジェクト共通 | 1,5,6 |
| `./CLAUDE.md`（プロジェクトルート） | チーム共有（gitにコミット） | 1,5,6 |
| `./CLAUDE.local.md` | 個人設定（.gitignoreに追加） | 6 |
| 子ディレクトリ内 | Claudeがそのディレクトリ作業時にオンデマンドで読み込み | 1 |

### 運用のベストプラクティス

- **簡潔に保つ**: 各行について「これを削除したらClaudeがミスをするか？」を問う（ソース1）
- **強調を活用**: 重要な指示には「IMPORTANT」や「YOU MUST」を付ける（ソース1）
- **定期的にレビュー**: 意図通りに動作しているか確認し、不要な項目を削除（ソース3,6）
- **gitで管理**: チーム全体で共有し、時間とともに価値を蓄積（ソース1,2）
- **`@`インポート構文**: `@docs/git-instructions.md`のように外部ファイルを参照可能（ソース1）

---

## 3. ワークフロー：探索→計画→実装→コミット

**公式ドキュメントが推奨する4フェーズワークフロー。**

### フェーズ1: 探索（Plan Mode）

- Plan Modeに入り、ファイルを読み込み、質問に回答させる（変更は行わない）
- `read /src/auth and understand how we handle sessions`

### フェーズ2: 計画（Plan Mode）

- 詳細な実装計画を作成させる
- `I want to add Google OAuth. What files need to change? Create a plan.`
- `Ctrl+G`でテキストエディタで計画を直接編集可能

### フェーズ3: 実装（Normal Mode）

- Normal Modeに切り替え、計画に基づいてコーディング
- テストの実行と失敗の修正を含める

### フェーズ4: コミット

- 説明的なメッセージでコミットし、PRを作成

### 計画をスキップすべき場面

- スコープが明確で修正が小さい場合（タイポ修正、ログ追加、変数名変更）
- 差分を一文で説明できる場合（ソース1）

---

## 4. 効果的なプロンプティング

### 明確なコンテキストの提供

| 戦略 | 悪い例 | 良い例 | ソース |
|------|--------|--------|--------|
| タスクの範囲を限定 | 「foo.pyにテストを追加して」 | 「foo.pyにログアウト時のエッジケースのテストを書いて。モックは避けて」 | 1 |
| 情報源を指定 | 「ExecutionFactoryのAPIが変な理由は？」 | 「ExecutionFactoryのgit履歴を調べてAPIの経緯を要約して」 | 1 |
| 既存パターンを参照 | 「カレンダーウィジェットを追加して」 | 「ホームページの既存ウィジェットを調べて。HotDogWidget.phpがパターンの好例。そのパターンに従って実装して」 | 1 |
| 症状を詳述 | 「ログインバグを直して」 | 「セッションタイムアウト後にログインが失敗する。src/auth/のトークンリフレッシュを確認して。再現テストを書いてから修正して」 | 1 |

### リッチコンテンツの活用

- `@`でファイルを参照（ソース1）
- 画像を直接ペースト（ソース1）
- URLでドキュメントを提供（ソース1）
- `cat error.log | claude`でデータをパイプ（ソース1）
- `Cmd+A`/`Ctrl+A`で全選択してペースト（ソース3）

### インタビュー手法（大規模機能向け）

大きな機能の場合、最初にClaudeにインタビューさせる（ソース1）：

```
[機能の概要]を構築したい。AskUserQuestionツールを使って詳細にインタビューして。
技術実装、UI/UX、エッジケース、トレードオフについて深掘りして。
すべてカバーしたらSPEC.mdに完全な仕様書を書いて。
```

仕様書完成後、新しいセッションで実装に入る。

---

## 5. 検証：自己チェックの仕組みを与える

**「これが最もレバレッジの高い施策」と公式ドキュメントが明言。**

### 検証方法一覧

| 方法 | 説明 | ソース |
|------|------|--------|
| テストの実行 | 実装後にテストを書かせて実行させる | 1,3 |
| スクリーンショット比較 | UI変更時にChrome拡張で視覚的に検証 | 1 |
| リンター/ビルドチェック | `npm run lint`等を実行させる | 1 |
| 自己確認の指示 | 「すべての主張をダブルチェックして」と明示的に依頼 | 3 |
| TDDの採用 | テスト駆動開発でテストを先に書かせる | 3 |
| draft PRの活用 | ドラフトPRを作成し、レビュー後に正式化 | 3 |
| サブエージェントでレビュー | 別エージェントにコードレビューさせる | 1 |

---

## 6. 環境設定とツール活用

### 権限設定

| モード | 説明 | ソース |
|--------|------|--------|
| default | 都度許可を求める（安全だがテンポが悪い） | 5 |
| acceptEdits | ファイル変更は自動承認 | 5 |
| plan | 読み取り専用 | 5 |
| bypassPermissions | 全権限をバイパス（コンテナ内限定推奨） | 5 |

- `/permissions`で安全なコマンドを許可リストに追加（ソース1）
- `/sandbox`でOS レベルの分離を有効化（ソース1）
- 承認済みコマンドを定期的に監査する（ソース3 - Tip 33）

### CLIツールの活用

- `gh`（GitHub CLI）: PR作成、Issue管理に最適（ソース1）
- `aws`, `gcloud`, `sentry-cli`等: 外部サービス連携（ソース1）
- 未知のCLIツールも`--help`で学習させられる（ソース1）

### MCPサーバー

- `claude mcp add`で外部ツール（Notion, Figma, DB等）を接続（ソース1,5）
- Playwright MCPでブラウザ自動操作が可能（ソース5）
- `/mcp`で利用可能なMCPを確認（ソース5）

### Hooks

- CLAUDE.mdの指示は「助言的」だが、Hooksは「決定的」（確実に実行される）（ソース1）
- 例: ファイル編集後にeslintを自動実行、特定フォルダへの書き込みをブロック
- `/hooks`で対話的に設定、または`.claude/settings.json`を直接編集

---

## 7. スキル（Skills）の活用

### スキルとは

- `.claude/skills/`にSKILL.mdファイルとして配置するドメイン知識・ワークフロー定義（ソース1,4）
- CLAUDE.mdとの違い: CLAUDE.mdは毎セッション読み込まれるが、スキルはオンデマンドで読み込まれる（ソース1,3）
- `disable-model-invocation: true`で手動トリガー専用にできる（ソース1）

### スキル設計のベストプラクティス（ソース4）

- YAML frontmatterでClaudeがいつスキルを読み込むか判断する
- SKILL.mdはコア指示に集中し、詳細なドキュメントは`references/`にリンク
- 作成前に2-3の具体的なユースケースを特定する
- テスト: 適切なタイミングで読み込まれるか、正しい出力を生成するか検証
- クロスプラットフォーム互換性を意識（Claude.ai, Claude Code, API共通）

---

## 8. 並列実行とスケーリング

### 並列セッション

- Claude Desktopで複数のローカルセッション管理（ソース1）
- Git Worktreesで並列ブランチ作業（ソース3,5）
  ```bash
  git worktree add ../project-feature-a -b feature-a
  cd ../project-feature-a && claude
  ```
- Writer/Reviewerパターン: セッションAで実装、セッションBでレビュー（ソース1）

### ヘッドレスモード

- `claude -p "prompt"`でCI/CDパイプライン、pre-commitフック、スクリプトに統合（ソース1）
- `--output-format json`で構造化出力（ソース1）
- `--allowedTools`で権限をスコープ（ソース1）

### ファンアウトパターン

大量のファイル移行・分析に有効（ソース1）：
```bash
for file in $(cat files.txt); do
  claude -p "Migrate $file from React to Vue. Return OK or FAIL." \
    --allowedTools "Edit,Bash(git commit *)"
done
```

---

## 9. セッション管理テクニック

| テクニック | コマンド/操作 | 説明 | ソース |
|-----------|-------------|------|--------|
| 中断 | `Esc` | 処理を停止（コンテキスト維持） | 1 |
| 巻き戻し | `Esc+Esc`または`/rewind` | チェックポイントに復元 | 1 |
| 元に戻す | `"Undo that"` | 変更を元に戻す | 1 |
| コンテキストリセット | `/clear` | 無関係なタスク間で使用 | 1,3 |
| 会話の再開 | `claude --continue` | 直近の会話を再開 | 1 |
| 会話の選択 | `claude --resume` | 過去の会話リストから選択 | 1 |
| セッション命名 | `/rename` | 会話に説明的な名前を付ける | 1 |
| エイリアス設定 | `alias c='claude'` | 起動を高速化 | 3 |

---

## 10. 実践的なTips（コミュニティ発）

ykdojoの40+Tipsリポジトリから厳選した実践的アドバイス：

| Tip | 内容 | 説明 |
|-----|------|------|
| 音声入力 | ボイス入力の活用 | superwhisper等のローカル音声認識で入力速度を大幅改善 |
| 3-4タスク制限 | 同時並行は最大3-4 | 「カスケード」方式で右にタブを開き左から順に処理 |
| 問題分解 | A→A1→A2→A3→B | 大きな問題を小さなステップに分割して段階的に解決 |
| 未知への勇気 | 反復的問題解決 | 完璧な計画より素早いプロトタイピングと反復を重視 |
| 過複雑コードの簡素化 | リファクタリング依頼 | 可読性とメンテナンス性を優先 |
| 自動化の自動化 | メタ自動化 | 反復的な自動化タスク自体を自動化するスクリプトを作成 |

---

## 11. よくある失敗パターンと対策

| パターン | 症状 | 対策 | ソース |
|----------|------|------|--------|
| キッチンシンク・セッション | 1つの会話で無関係なタスクを混在 | `/clear`でタスク間をリセット | 1 |
| 訂正の繰り返し | 同じ間違いを何度も訂正 | 2回失敗したら`/clear`して改善プロンプトで再開 | 1 |
| CLAUDE.md肥大化 | 指示が多すぎて重要なルールが埋もれる | 定期的に剪定。Hooksに移行できるものは移行 | 1 |
| 信頼後検証ギャップ | もっともらしいがエッジケース未対応の実装 | 常に検証手段（テスト、スクリプト）を提供 | 1 |
| 無限探索 | スコープ未限定の調査で大量ファイル読み込み | サブエージェント使用またはスコープを狭める | 1 |

---

## まとめ：最重要ポイントTOP 5

全ソースを横断して最も強調されているポイント：

1. **コンテキスト管理を徹底する** — `/clear`を頻繁に使い、会話を新鮮に保つ。これがClaude Codeの品質を最も左右する
2. **検証手段を必ず提供する** — テスト、リンター、スクリーンショット等、Claudeが自己チェックできる仕組みを用意する
3. **CLAUDE.mdを簡潔に保つ** — 少ないが効果的な指示。肥大化は性能低下に直結する
4. **探索→計画→実装の順序を守る** — いきなりコーディングさせず、Plan Modeで理解を深めてから実装に移る
5. **サブエージェントとスキルで拡張する** — 調査はサブエージェントに委譲し、ドメイン知識はスキルで管理する

---

*このレポートは2025年1月時点の情報に基づいています。Claude Codeは活発に開発されており、最新の機能や推奨事項は公式ドキュメントを参照してください。*
